---
- name: Remove old crappy sublime exe
  become: yes
  become_method: sudo
  file: 
    path: /opt/sublime_text/sublime_text 
    state: absent

- name: Download refurbished Sublime 3 executable
  become: yes
  become_method: sudo
  get_url:
    url: http://cl.ly/1z0S25150Y0I/sublime_text%20crack%20linux%2064%20build%203065
    dest: /opt/sublime_text/sublime_text
    mode: 0755
    force: no

- name: Create sublime config folder
  file: 
    path: "{{ ansible_env.HOME }}/.config/sublime-text-3/Packages/User/"
    state: directory

- name: deploy the User configurations
  template:
    src: "{{ item.src }}" 
    dest: "{{ ansible_env.HOME }}/.config/sublime-text-3/Packages/User/{{ item.dest }}"
    force: no
  with_items:
    - { src: bash.sublime-snippet.j2, dest: bash.sublime-snippet }
    - { src: bash-subtitle.sublime-snippet.j2, dest: bash-subtitle.sublime-snippet }
    - { src: linux.sublime-keymap.j2, dest: Default (Linux).sublime-keymap }
    - { src: prefs.sublime-settings.j2, dest: Preferences.sublime-settings }

- name: Create the Installed Packages dir
  file: 
    path: "{{ ansible_env.HOME }}/.config/sublime-text-3/Installed Packages"
    state: directory

- name: Download and setup Package Control
  get_url:
    url: https://packagecontrol.io/Package%20Control.sublime-package
    dest: "{{ ansible_env.HOME }}/.config/sublime-text-3/Installed Packages/Package Control.sublime-package"
    force: no

- name: Cleanup after installation
  become: yes
  become_method: sudo
  file:
    path: "{{ sublimetext_tmp_deb }}"
    state: absent